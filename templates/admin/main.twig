<div class="wrap">

    <!-- Header du Dashboard -->
    <div class="dashboard-header">
        <h1>üîå Plugin Maryam - Dashboard</h1>
        <p class="dashboard-description">G√©rez votre connexion Salesforce et vos rapports</p>
    </div>

    {% if success_message %}
        <div class="notice notice-success is-dismissible">
            <p><strong>{{ success_message }}</strong></p>
        </div>
    {% endif %}

    <!-- Widgets Statistiques -->
    <div class="dashboard-widgets">
        <div class="widget-card widget-{{ connection_status|default('unknown') }}">
            <span class="widget-icon">üîó</span>
            <div class="widget-content">
                <span class="widget-value">{{ connection_status_label|default('Non test√©') }}</span>
                <span class="widget-label">Statut Connexion</span>
            </div>
        </div>

        <div class="widget-card">
            <span class="widget-icon">üìÖ</span>
            <div class="widget-content">
                <span class="widget-value">{{ last_report_date|default('Aucun') }}</span>
                <span class="widget-label">Dernier Rapport</span>
            </div>
        </div>

        <div class="widget-card">
            <span class="widget-icon">üìä</span>
            <div class="widget-content">
                <span class="widget-value">{{ total_reports|default('0') }}</span>
                <span class="widget-label">Rapports G√©n√©r√©s</span>
            </div>
        </div>

        <div class="widget-card">
            <span class="widget-icon">‚úÖ</span>
            <div class="widget-content">
                <span class="widget-value">{{ total_connections|default('0') }}</span>
                <span class="widget-label">Connexions R√©ussies</span>
            </div>
        </div>
    </div>

    <!-- Conteneur principal √† 2 colonnes -->
    <div class="config-container" style="display: flex; gap: 20px; flex-wrap: wrap;">

        <!-- COLONNE GAUCHE : Configuration Salesforce -->
        <div class="postbox" style="flex: 1; min-width: 400px;">
            <center>
                <h2 class="hndle">
                    <span>Configuration Salesforce</span>
                </h2>
            </center>

            <div class="inside">
                <form method="post" action="{{ admin_url }}admin-post.php">
                    <input type="hidden" name="action" value="save_my_plugin_settings" />
                    {{ nonce_field|raw }}

                    <!-- Credentials API -->
                    <div class="config-group">
                        <h3 class="config-group-title">üîê Credentials API</h3>
                    </div>

                    <table class="form-table">
                        <tr>
                            <th scope="row">Instance</th>
                            <td>
                                <input type="text"
                                       name="my_plugin_settings[instance]"
                                       value="{{ settings.instance|default('') }}"
                                       class="regular-text" />
                                <p class="description">Nom de l'instance Salesforce</p>
                            </td>
                        </tr>

                        <tr>
                            <th scope="row">Client ID</th>
                            <td>
                                <input type="text"
                                       name="my_plugin_settings[client_id]"
                                       value="{{ settings.client_id|default('') }}"
                                       class="regular-text" />
                            </td>
                        </tr>

                        <tr>
                            <th scope="row">Client Secret</th>
                            <td>
                                <input type="password"
                                       name="my_plugin_settings[client_secret]"
                                       value="{{ settings.client_secret|default('') }}"
                                       class="regular-text" />
                            </td>
                        </tr>
                    </table>

                    <!-- Authentification Utilisateur -->
                    <div class="config-group">
                        <h3 class="config-group-title">üë§ Authentification Utilisateur</h3>
                    </div>

                    <table class="form-table">
                        <tr>
                            <th scope="row">Username</th>
                            <td>
                                <input type="text"
                                       name="my_plugin_settings[User_namme]"
                                       value="{{ settings.User_namme|default('') }}"
                                       class="regular-text" />
                            </td>
                        </tr>

                        <tr>
                            <th scope="row">Password</th>
                            <td>
                                <input type="password"
                                       name="my_plugin_settings[pass]"
                                       value="{{ settings.pass|default('') }}"
                                       class="regular-text" />
                            </td>
                        </tr>

                        <tr>
                            <th scope="row">User Secret</th>
                            <td>
                                <input type="text"
                                       name="my_plugin_settings[UserSecret]"
                                       value="{{ settings.UserSecret|default('') }}"
                                       class="regular-text" />
                            </td>
                        </tr>
                    </table>

                    <!-- Configuration Rapport -->
                    <div class="config-group">
                        <h3 class="config-group-title">üìÑ Configuration Rapport</h3>
                    </div>

                    <table class="form-table">
                        <tr>
                            <th scope="row">Report ID</th>
                            <td>
                                <input type="text"
                                       name="my_plugin_settings[report_id]"
                                       value="{{ settings.report_id|default('') }}"
                                       class="regular-text" />
                            </td>
                        </tr>

                        <tr>
                            <th scope="row">Host URL</th>
                            <td>
                                <input type="text"
                                       name="my_plugin_settings[HostUrl]"
                                       value="{{ settings.HostUrl|default('') }}"
                                       class="regular-text" />
                            </td>
                        </tr>
                    </table>

                    <hr>

                    <!-- Conteneur des 3 boutons align√©s -->
                    <div class="my-plugin-buttons-row">
                        <input type="submit"
                               class="button button-primary my-plugin-btn"
                               value="Enregistrer les param√®tres">

                        <div class="my-plugin-btn-container">
                            <button type="button"
                                    class="button button-primary my-plugin-btn ajax-action"
                                    data-action="test_salesforce_connection">
                                Connexion Salesforce
                            </button>
                            <span class="ajax-result"></span>
                        </div>

                        <div class="my-plugin-btn-container">
                            <button type="button"
                                    class="button button-primary my-plugin-btn ajax-action"
                                    data-action="download_salesforce_report"
                                    id="download-report-btn">
                                T√©l√©charger le rapport
                            </button>
                            <span class="download-result"></span>
                        </div>
                    </div>

                </form>
            </div>
        </div>

        <!-- COLONNE DROITE : Configuration Gmail API -->
        <div class="postbox" style="flex: 1; min-width: 400px; height: fit-content;">
            <center>
                <h2 class="hndle">
                    <span>Configuration Gmail API</span>
                </h2>
            </center>

            <div class="inside">
                <form method="post" action="{{ admin_url }}admin-post.php">
                    <input type="hidden" name="action" value="save_gmail_settings" />
                    {{ nonce_field|raw }}

                    <div class="config-group">
                        <h3 class="config-group-title">üìß Credentials Gmail</h3>
                    </div>

                    <table class="form-table">
                        <tr>
                            <th scope="row">Gmail Client ID</th>
                            <td>
                                <input type="text"
                                       name="my_plugin_settings[gmail_client_id]"
                                       value="{{ settings.gmail_client_id|default('') }}"
                                       class="regular-text" />
                                <p class="description">Client ID Google Cloud Console</p>
                            </td>
                        </tr>

                        <tr>
                            <th scope="row">Gmail Client Secret</th>
                            <td>
                                <input type="password"
                                       name="my_plugin_settings[gmail_client_secret]"
                                       value="{{ settings.gmail_client_secret|default('') }}"
                                       class="regular-text" />
                                <p class="description">Client Secret Google Cloud Console</p>
                            </td>
                        </tr>

                        <tr>
                            <th scope="row">Gmail Refresh Token</th>
                            <td>
                                <input type="password"
                                       name="my_plugin_settings[gmail_refresh_token]"
                                       value="{{ settings.gmail_refresh_token|default('') }}"
                                       class="regular-text" />
                                <p class="description">Refresh Token OAuth2</p>
                            </td>
                        </tr>
                    </table>

                    <hr>

                    <div class="my-plugin-buttons-row">
                        <input type="submit"
                               class="button button-primary my-plugin-btn"
                               value="Enregistrer Gmail">
                    </div>

                </form>
            </div>
        </div>

    </div>

    <!-- Section Aide -->
    <div class="dashboard-section dashboard-help">
        <div class="section-header">
            <h2 class="section-title">‚ùì Aide & Documentation</h2>
        </div>
        <div class="section-content">
            <ul class="help-list">
                <li>üìñ <strong>Instance</strong> : Nom de votre organisation Salesforce</li>
                <li>üîë <strong>Client ID & Secret</strong> : Obtenus depuis Salesforce Connected App</li>
                <li>üë§ <strong>Username</strong> : Votre email Salesforce</li>
                <li>üîí <strong>User Secret</strong> : Token de s√©curit√© Salesforce</li>
                <li>üìä <strong>Report ID</strong> : ID du rapport √† t√©l√©charger</li>
                <li>üìß <strong>Gmail API</strong> : Credentials depuis Google Cloud Console</li>
            </ul>
        </div>
    </div>

</div>
```

---

